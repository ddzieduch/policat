<?php

/**
 * InvitationCampaignTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class InvitationCampaignTable extends Doctrine_Table {

  /**
   * Returns an instance of this class.
   *
   * @return InvitationCampaignTable The table instance
   */
  public static function getInstance() {
    return Doctrine_Core::getTable('InvitationCampaign');
  }

  public function findByInvitationAndCampaign($invitation, $campaign) {
    return $this->createQuery('ic')->where('ic.invitation_id = ? and ic.campaign_id = ?', array($invitation->getId(), $campaign->getId()))->fetchOne();
  }

  public function findByCampaignNotExpired(Campaign $campaign) {
    return $this->createQuery('ic')
        ->where('ic.campaign_id = ?', array($campaign->getId()))
        ->andWhere('ic.invitation_id in (SELECT i.id FROM Invitation i WHERE i.expires_at > NOW())')
        ->execute();
  }

}
